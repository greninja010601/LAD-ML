{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Screen 8 - Early Feedback</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Fonts and Styles -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <link rel="stylesheet" href="{% static 'style_screen8.css' %}">
</head>
<body>
<div class="container-wrapper">
    <!-- Sidebar -->
    <div class="icon-tab">
        {% include 'index.html' %}
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="options-header">
            <div class="heading">
                Course: <span class="highlight">{{ course_name }}</span>
            </div>
            <div class="buttons-container">
                <button class="help-button">
                    <img src="{% static 'images/Bell.png' %}" alt="Notification" class="help-icon">
                </button>
                <button class="help-button">
                    <img src="{% static 'images/Menu.png' %}" alt="Menu" class="help-icon">
                </button>
            </div>
        </div>

        <div class="content-card shimmer-card" id="shimmerCard">
            <h2>üìä Early Performance Feedback</h2>

            <div class="robot-loading" id="robotLoader" style="display: none; flex-direction: column; align-items: center;">
                <div class="robot-head" style="width: 140px; height: 190px;">
                    <div class="question-mark">?</div>
                    <div class="eye left"></div>
                    <div class="eye right"></div>
                    <div class="mouth"></div>
                    <div class="gear-system" style="top: 20px; left: 25px; width: 100px; height: 70px;">
                        <div class="gear left" style="width: 70px; height: 42px;">
                            <svg viewBox="0 0 100 100">
                                <path d="M78.7,54.1c0.2-1.4,0.3-2.8,0.3-4.1s-0.1-2.7-0.3-4.1l8.1-6.3c0.7-0.5,0.9-1.5,0.5-2.2l-7.6-13.2
                                c-0.4-0.7-1.3-1-2.1-0.7l-9.6,3.8c-2.2-1.7-4.7-3.1-7.4-4.1L59.5,9c-0.1-0.8-0.8-1.4-1.6-1.4h-15c-0.8,0-1.5,0.6-1.6,1.4
                                l-1.2,10.3c-2.7,1-5.2,2.4-7.4,4.1l-9.6-3.8c-0.8-0.3-1.7,0-2.1,0.7l-7.6,13.2c-0.4,0.7-0.2,1.6,0.5,2.2l8.1,6.3
                                c-0.2,1.4-0.3,2.8-0.3,4.1s0.1,2.7,0.3,4.1L15.5,60.4c-0.7,0.5-0.9,1.5-0.5,2.2l7.6,13.2c0.4,0.7,1.3,1,2.1,0.7l9.6-3.8
                                c2.2,1.7,4.7,3.1,7.4,4.1l1.2,10.3c0.1,0.8,0.8,1.4,1.6,1.4h15c0.8,0,1.5-0.6,1.6-1.4l1.2-10.3c2.7-1,5.2-2.4,7.4-4.1l9.6,3.8
                                c0.8,0.3,1.7,0,2.1-0.7l7.6-13.2c0.4-0.7,0.2-1.6-0.5-2.2L78.7,54.1z M50,65c-8.3,0-15-6.7-15-15S41.7,35,50,35s15,6.7,15,15
                                S58.3,65,50,65z"/>
                            </svg>
                        </div>
                        <div class="gear right" style="width: 42px; height: 42px; left: 34px; top: 24px;">
                            <svg viewBox="0 0 100 100">
                                <path d="M78.7,54.1c0.2-1.4,0.3-2.8,0.3-4.1s-0.1-2.7-0.3-4.1l8.1-6.3c0.7-0.5,0.9-1.5,0.5-2.2l-7.6-13.2
                                c-0.4-0.7-1.3-1-2.1-0.7l-9.6,3.8c-2.2-1.7-4.7-3.1-7.4-4.1L59.5,9c-0.1-0.8-0.8-1.4-1.6-1.4h-15c-0.8,0-1.5,0.6-1.6,1.4
                                l-1.2,10.3c-2.7,1-5.2,2.4-7.4,4.1l-9.6-3.8c-0.8-0.3-1.7,0-2.1,0.7l-7.6,13.2c-0.4,0.7-0.2,1.6,0.5,2.2l8.1,6.3
                                c-0.2,1.4-0.3,2.8-0.3,4.1s0.1,2.7,0.3,4.1L15.5,60.4c-0.7,0.5-0.9,1.5-0.5,2.2l7.6,13.2c0.4,0.7,1.3,1,2.1,0.7l9.6-3.8
                                c2.2,1.7,4.7,3.1,7.4,4.1l1.2,10.3c0.1,0.8,0.8,1.4,1.6,1.4h15c0.8,0,1.5-0.6,1.6-1.4l1.2-10.3c2.7-1,5.2-2.4,7.4-4.1l9.6,3.8
                                c0.8,0.3,1.7,0,2.1-0.7l7.6-13.2c0.4-0.7,0.2-1.6-0.5-2.2L78.7,54.1z M50,65c-8.3,0-15-6.7-15-15S41.7,35,50,35s15,6.7,15,15
                                S58.3,65,50,65z"/>
                            </svg>
                        </div>
                    </div>
                </div>
                <div class="predicting-text">Predicting...</div>
            </div>

            <div id="contentBlock">
                <p><strong>Student Name:</strong> <span class="highlight">{{ student_name }}</span></p>

                {% if grade_info %}
                    <p><strong>Current Grade:</strong> <span class="highlight">{{ grade_info.current_grade }}</span></p>
                {% endif %}

                {% if predicted_score %}
                    <p><strong>Predicted Final Score ({{ prediction_type }}%):</strong> 
                        <span class="highlight">{{ predicted_score }}%</span>
                    </p>
                {% endif %}

                {% if prediction_type == "20" %}
                    <p><strong>Model Accuracy (20%):</strong> <span class="highlight">{{ accuracy_20 }}%</span></p>
                {% elif prediction_type == "50" %}
                    <p><strong>Model Accuracy (50%):</strong> <span class="highlight">{{ accuracy_50 }}%</span></p>
                {% endif %}

                {% if prediction_message %}
                    <p class="alert"><strong>{{ prediction_message }}</strong></p>
                {% endif %}
            </div>

            <div class="prediction-buttons">
                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="prediction_type" value="20">
                    <button type="submit" class="predict-btn">Predict at 20%</button>
                </form>

                <form method="POST">
                    {% csrf_token %}
                    <input type="hidden" name="prediction_type" value="50">
                    <button type="submit" class="predict-btn">Predict at 50%</button>
                </form>
            </div>

            <div style="margin-top: 30px;">
                <a href="{% url 'screen_1' course_id=course_id course_name=course_name student_name=student_name user_id=user_id %}" class="back-btn">‚Üê Go Back</a>
            </div>
        </div>
    </div>
</div>

<script>
  document.querySelectorAll('.predict-btn').forEach(btn => {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      document.getElementById('robotLoader').style.display = 'flex';
      document.getElementById('shimmerCard').classList.add('loading');
      document.getElementById('contentBlock').style.display = 'none';
      setTimeout(() => {
        btn.closest('form').submit();
      }, 20000);
    });
  });
</script>
</body>
</html>
